FROM microsoft/dotnet:2.1.403-sdk-bionic
LABEL author="https://github.com/larssb"

# Install PowerShell
COPY --from=mcr.microsoft.com/powershell:6.1.0-ubuntu-18.04 / /

# Change the default shell to PowerShell
SHELL [ "pwsh", "-Command", "$ErrorActionPreference = 'Stop'; $ProgressPreference = 'SilentlyContinue';" ]

# Copy the PowerShellTooling module into the container
COPY ./PowerShellTooling /usr/local/share/powershell/Modules/PowerShellTooling/1.0.2/

# Install modules required for building HealOps. Uses force to avoid "the untrusted prompt to stop us"
RUN Install-Module -Name Pester -Force; Install-Module -Name InvokeBuild -Force

# Set the intended command to use.
CMD [ "pwsh", "-Help" ]